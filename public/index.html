<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client</title>
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

</head>

<body>


    <div class="w3-row-padding">
        <div class="w3-col s12 w3-center">
            <img class="w3-image" src="./pictures/logo.png" alt="Logo">
        </div>
    </div>



    <div class="w3-row">
        <div class="w3-col l4">
            <p class="w3-show">
                I am hidden.
            </p>
        </div>
        <div class="w3-col l2 m6 s6 w3-center">
            <form id="loginform" class="login-form center">
                <div class="form-title">
                    <h2>Login</h2>
                </div>
                <label><input id="loginUsername" type="text" placeholder="Username" name="name"> </label>
                <label><input id="loginPsw" type="password" placeholder="Password" name="password"></label>
                <button id="subLogin" class="red" type="submit">Login</button>
            </form>
        </div>
        <div class="w3-col l2 s6 m6 w3-center">
            <form id="createform" class="create-form center">
                <div class="form-title">
                    <h2>Create Account</h2>
                </div>
                <label><input id="createUsername" type="text" placeholder="Username" name="name"> </label>
                <label><input id="createPsw" type="password" placeholder="Password" name="password"></label>
                <label><input id="createPswConf" type="password" placeholder="Confirm Password" name="passwordConf"></label>
                <button id="subAcc" class="red" type="submit">Create account</button>
            </form>
        </div>
        <div class="w3-col l4">
            <p class="w3-show">
                I am hidden.
            </p>
        </div>
    </div>



</body>


<script>    

    


    //login user

    const loginUser = document.getElementById("loginform");

    loginUser.addEventListener("submit", async function(evt){
        
        evt.preventDefault();

        const loginUsername = document.getElementById("loginUsername").value;
        const loginPsw = document.getElementById("loginPsw").value;

        if(loginUsername !== "" && loginPsw !== ""){

        let username = loginUsername;
        let password = loginPsw;

       

        const credentials = "Basic " + window.btoa(`${username}:${password}`); //kryptert streng
        //const credentials = username + ":" + password; //til ren streng/tekst

        
        let config = {
            method: "GET",
            headers: {
            "content-type": "application/json",
            "authorization": credentials
            }
        }

        /*fetch("/user", config).then(resp => {
            redirect(resp);
        });*/

        const response = await fetch("/authenticate", config);
        //location.href = "/authenticate";
        //const data = await response.json();
        //serverResp(response, data, 1); //sender response og data til funksjonen 1 = login

    }else{
        // p shows up with text info
        //const infoDiv = document.getElementById("info");
        //infoDiv.innerHTML = "Invalid username or password";
        //document.body.appendChild(infoDiv);
    }

    })

    
    //


    //create User
    const userform = document.getElementById('createform');

    userform.addEventListener('submit', async function(evt) {

    evt.preventDefault();

    const createUsername = document.getElementById("createUsername").value;
    const createPassword = document.getElementById("createPsw").value;

    if(createUsername !== "" && createPassword !== ""){

    const createPasswordConf = document.getElementById("createPswConf").value;

    if(createPassword === createPasswordConf){

            let body = {
                username: createUsername,
                password: createPassword
            }
            let config = {
                method: "POST",
                headers: {
                    "content-type": "application/json"
                },
                body: JSON.stringify(body)
            }

            /*fetch("/user", config).then(resp => {
                redirect(resp);
            });*/

            const response = await fetch("/user", config);
            //const data = await response.json();
            //serverResp(response, data, 2); //sender response og data til funksjonen 2 = createUser

        }else{
            // p shows up with text info2
            const infoDiv = document.getElementById("info2");
            infoDiv.innerHTML = "Passwords don't match!";
            document.body.appendChild(infoDiv);

            
        }
    }else{
        // p shows up with text info2
        //const infoDiv = document.getElementById("info2");
        //infoDiv.innerHTML = "Invalid username or password";
        //document.body.appendChild(infoDiv);
    }


    });

    //

    function serverResp(res, data, num){
        console.log(res.status);
        //console.log(data.response)
        if(data.token){
            console.log(data.token);
            localStorage.setItem("token", data.token);
        }
        //

        //sjekker om num 1 = login eller om num 2 = createUser, for Ã¥ gi brukeren beskjed i riktig div
        switch(num){
            case 1:
                //document.getElementById("info").innerHTML = data.response;
                break;
            case 2:
                //document.getElementById("info2").innerHTML = data.response;
        }
    }

    //
    
    
</script>