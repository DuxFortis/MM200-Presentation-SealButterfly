<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">    
    <title>Client</title>
    <link rel="stylesheet" href="index.css">
</head>
<body>

    <img id="logo" src= "./pictures/logo.png">

    <form id="loginform">
        <h1>Login</h1>
        <label id="loginUserLab" for="loginUsername">Username: </label>
        <br>
        <input name="Username" id="loginUsername" type="text" value="test" />

        <label id="loginPswLab" for="loginPsw">Password: </label>
        <br>
        <input name="psw" id="loginPsw" type="password" value="aaa" />

        
        <input id="subLogin" type="submit" value="Login">

    </form>

    <p id="info"></p>

    

    
    
    <form id="createform">
        <h1>Create Account</h1>
        <label id="createUsername" for="createUsername">Username: </label>
        <br>
        <input name="Username" id="createUsername" type="text" value="test" />

        <label id="createPsw" for="createPsw">Password: </label>
        <br>
        <input name="psw" id="createPsw" type="password" value="aaa" />

        <label id="createPasswordConf" for="createPswConf">Confirm Password: </label>
        <br>
        <input name="psw" id="createPswConf" type="password" value="aaa" />

        <input id="subAcc" type="submit" value="Create Account">
     
    </form>

    <p id="info2"></p>

    
</body>



<script>    

    


    //login user

    const loginUser = document.getElementById("loginform");

    loginUser.addEventListener("submit", async function(evt){
        
        evt.preventDefault();

        const loginUsername = document.getElementById("loginUsername").value;
        const loginPsw = document.getElementById("loginPsw").value;

        if(loginUsername !== "" && loginPsw !== ""){

        let username = loginUsername
        let password = loginPsw

       

        const credentials = "Basic " + window.btoa(`${username}:${password}`); //kryptert streng
        //const credentials = username + ":" + password; //til ren streng/tekst

        
        let config = {
            method: "GET",
            headers: {
            "content-type": "application/json",
            "authorization": credentials
            }
        }

        /*fetch("/user", config).then(resp => {
            redirect(resp);
        });*/

        const response = await fetch("/user", config);
        const data = await response.json();
        serverResp(response, data, 1); //sender response og data til funksjonen 1 = login

    }else{
        // p shows up with text info
        const infoDiv = document.getElementById("info");
        infoDiv.innerHTML = "Invalid username or password";
        document.body.appendChild(infoDiv);
    }

    });
    
    //


    //create User
    const userform = document.getElementById('createform');

    userform.addEventListener('submit', async function(evt) {

    evt.preventDefault();

    const createUsername = document.getElementById("createUsername").value;
    const createPassword = document.getElementById("createPsw").value;

    if(createUsername !== "" && createPassword !== ""){

    const createPasswordConf = document.getElementById("createPswConf").value;

    if(createPassword === createPasswordConf){

            let body = {
                username: createUsername,
                password: createPassword
            }
            let config = {
                method: "POST",
                headers: {
                    "content-type": "application/json"
                },
                body: JSON.stringify(body)
            }

            /*fetch("/user", config).then(resp => {
                redirect(resp);
            });*/

            const response = await fetch("/user", config);
            const data = await response.json();
            serverResp(response, data, 2); //sender response og data til funksjonen 2 = createUser

        }else{
            // p shows up with text info2
            const infoDiv = document.getElementById("info2");
            infoDiv.innerHTML = "Passwords don't match!";
            document.body.appendChild(infoDiv);

            
        }
    }else{
        // p shows up with text info2
        const infoDiv = document.getElementById("info2");
        infoDiv.innerHTML = "Invalid username or password";
        document.body.appendChild(infoDiv);
    }


    });

    //

    function serverResp(res, data, num){
        console.log(res.status); //skriver ut status i console, feks 200, 401
        console.log(data.response); //skriver ut responsen, feks "login successful"

        if(data.token){
            //console.log(data.token);
            localStorage.setItem("token", data.token);
        }
        //

        //sjekker om num 1 = login eller om num 2 = createUser, for Ã¥ gi brukeren beskjed i riktig div
        switch(num){
            case 1:
                document.getElementById("info").innerHTML = data.response;
                break;
            case 2:
                document.getElementById("info2").innerHTML = data.response;
        }
    }

    //
    
    
</script>

</html>
